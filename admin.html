<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Barbearia 301 - ERP Master v17</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Ajuste de Dimensão e Prevenção de Zoom */
        body { 
            background-color: #0f172a; 
            color: #f8fafc; 
            font-family: 'Inter', sans-serif; 
            margin: 0;
            padding: 0;
            overflow: hidden; /* Mantém a estrutura fixa */
            height: 100vh;
            width: 100vw;
        }

        /* Força inputs a não darem zoom no iOS */
        input, select, textarea { font-size: 16px !important; }

        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        
        /* Sidebar adaptativa para Mobile (embaixo) e Desktop (lado) */
        .sidebar-item { transition: 0.3s; cursor: pointer; border-radius: 8px; padding: 0.8rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; flex-direction: column; font-size: 10px; flex: 1; }
        
        @media (min-width: 768px) {
            .sidebar-item { flex-direction: row; justify-content: flex-start; font-size: 14px; margin-bottom: 4px; flex: none; }
            body { overflow: initial; }
        }

        .sidebar-item:hover, .active-menu { background: #334155; color: #38bdf8; border-bottom: 3px solid #38bdf8; }
        
        @media (min-width: 768px) {
            .active-menu { border-bottom: none; border-left: 4px solid #38bdf8; }
        }

        /* Grid da Agenda com Scroll Controlado */
        .grid-agenda { display: grid; border: 1px solid #1e293b; border-radius: 12px; overflow: hidden; min-width: 600px; }
        .cell { padding: 10px; border: 1px solid #1e293b; text-align: center; font-size: 0.75rem; min-height: 45px; display: flex; align-items: center; justify-content: center; }
        
        /* Ajuste fino para o scroll do Main no mobile */
        main {
            height: calc(100vh - 80px); /* Desconta a altura da nav mobile */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        @media (min-width: 768px) {
            main { height: 100vh; }
        }

        .nota-fiscal { font-family: 'Courier New', Courier, monospace; background: #fff; color: #000; padding: 20px; width: 100%; max-width: 320px; margin: auto; }
    </style>
</head>
<body class="flex flex-col md:flex-row bg-slate-950">

    <main class="order-1 md:order-2 flex-1 p-4 md:p-8">
        
        <section id="sec-dashboard">
            <h1 class="text-2xl font-bold mb-6 italic text-white">Fluxo <span class="text-sky-500">Hoje</span></h1>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 mb-4" id="dash-cards"></div>
            <div class="glass p-4 rounded-2xl border-l-4 border-emerald-500">
                <h3 class="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Bruto do Dia</h3>
                <h2 class="text-2xl md:text-4xl font-black" id="dash-total">R$ 0,00</h2>
            </div>
        </section>

        <section id="sec-agenda" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-start mb-6 gap-2">
                <h2 class="text-xl font-bold">Agenda Global</h2>
                <input type="date" id="data-seletor" onchange="renderTudo()" class="w-full md:w-auto p-2 rounded-lg text-xs bg-slate-800 border-slate-700 text-white">
            </div>
            <div class="overflow-x-auto rounded-2xl border border-slate-800 glass">
                <div class="grid-agenda" id="grid-agenda"></div>
            </div>
            <p class="text-[10px] text-slate-500 mt-2 italic md:hidden text-center">Deslize para o lado para ver a equipe ➔</p>
        </section>

        <section id="sec-estoque" class="hidden">
             <h2 class="text-xl font-bold mb-6">Estoque</h2>
             <div class="glass p-4 rounded-2xl mb-4" id="form-estoque">
                <div class="grid grid-cols-1 gap-2">
                    <input type="text" id="item-nome" placeholder="Nome" class="p-2 rounded-lg bg-slate-800">
                    <input type="number" id="item-preco" placeholder="Preço" class="p-2 rounded-lg bg-slate-800">
                    <select id="item-tipo" class="p-2 rounded-lg bg-slate-800">
                        <option value="produto">Produto</option>
                        <option value="servico">Serviço</option>
                    </select>
                    <button onclick="salvarItem()" class="bg-emerald-600 p-2 rounded-lg font-bold">ADICIONAR</button>
                </div>
             </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="glass p-4 rounded-xl overflow-x-auto"><table class="w-full text-xs"><tbody id="list-produtos"></tbody></table></div>
                <div class="glass p-4 rounded-xl overflow-x-auto"><table class="w-full text-xs"><tbody id="list-servicos"></tbody></table></div>
             </div>
        </section>

        <section id="sec-relatorio" class="hidden text-center">
            <h2 class="text-xl font-bold mb-6 text-emerald-400 uppercase">Relatório</h2>
            <div id="relatorio-box" class="flex justify-center py-2"></div>
            <button onclick="enviarRelatorio()" class="mt-4 bg-sky-600 px-6 py-2 rounded-xl font-bold text-xs">NOTIFICAR ADMINS</button>
        </section>

        <section id="sec-admin" class="hidden">
            <h2 class="text-xl font-bold mb-6 text-amber-500 italic">Gestão Unidade</h2>
            <div class="grid grid-cols-1 gap-4">
                <div class="glass p-4 rounded-2xl">
                    <input type="text" id="p-nome" placeholder="Nome Barbeiro" class="w-full p-2 mb-2 rounded-lg bg-slate-800">
                    <input type="number" id="p-com" placeholder="Comissão %" class="w-full p-2 mb-2 rounded-lg bg-slate-800">
                    <input type="password" id="p-pass" placeholder="Senha" class="w-full p-2 mb-2 rounded-lg bg-slate-800">
                    <button onclick="salvarProfissional()" class="w-full bg-sky-600 p-2 rounded-lg font-bold">CADASTRAR</button>
                </div>
            </div>
            <div class="glass p-4 mt-4 rounded-2xl overflow-x-auto">
                <table class="w-full text-xs text-left"><tbody id="lista-equipe"></tbody></table>
            </div>
        </section>
    </main>

    <aside class="order-2 md:order-1 w-full md:w-64 glass flex flex-row md:flex-col p-2 md:p-4 gap-1 z-50">
        <div class="hidden md:block p-4 text-center border-b border-slate-800 mb-4">
            <div class="w-12 h-12 rounded-full mx-auto mb-2 border-2 border-sky-500 overflow-hidden">
                <img src="logo.png" class="w-full h-full object-cover" onerror="this.src='https://cdn-icons-png.flaticon.com/512/301/301131.png'">
            </div>
            <p class="text-[10px] font-black text-sky-500 uppercase">Barbearia 301</p>
        </div>
        
        <nav class="flex flex-row md:flex-col flex-1 gap-1">
            <div onclick="showSection('dashboard')" class="sidebar-item active-menu" id="menu-dashboard"><i class="fas fa-chart-line"></i><span>Dash</span></div>
            <div onclick="showSection('agenda')" class="sidebar-item" id="menu-agenda"><i class="fas fa-calendar"></i><span>Agenda</span></div>
            <div onclick="showSection('estoque')" class="sidebar-item" id="menu-estoque"><i class="fas fa-box"></i><span>Itens</span></div>
            <div onclick="showSection('relatorio')" class="sidebar-item text-emerald-400" id="menu-relatorio"><i class="fas fa-file-invoice-dollar"></i><span>Fisc</span></div>
            <div onclick="showSection('admin')" class="sidebar-item text-amber-400" id="menu-admin"><i class="fas fa-user-shield"></i><span>Adm</span></div>
        </nav>
    </aside>

    <div id="modal-venda" class="hidden fixed inset-0 z-[110] flex items-center justify-center bg-black/90 p-4 backdrop-blur-sm">
        <div class="glass p-6 rounded-3xl w-full max-w-xs border border-slate-700">
            <h3 class="text-md font-bold mb-4 text-sky-400 text-center uppercase">Fechar Venda</h3>
            <div id="venda-info" class="text-[10px] text-slate-400 mb-4 text-center"></div>
            <div class="flex flex-col gap-3">
                <select id="venda-prof" class="w-full p-2 rounded-xl text-sm bg-slate-800 text-white"></select>
                <select id="venda-item" class="w-full p-2 rounded-xl text-sm bg-slate-800 text-white"></select>
                <select id="venda-pag" class="w-full p-2 rounded-xl text-sm bg-slate-800 text-white">
                    <option value="pix">PIX</option><option value="dinheiro">Dinheiro</option><option value="debito">Débito</option><option value="credito">Crédito</option>
                </select>
                <button onclick="finalizarVendaReal()" class="w-full bg-emerald-600 p-3 rounded-xl font-bold uppercase text-xs">Confirmar</button>
                <button onclick="excluirHorario()" class="text-red-500 text-[10px] font-bold">EXCLUIR AGENDAMENTO</button>
                <button onclick="document.getElementById('modal-venda').classList.add('hidden')" class="text-slate-500 text-[10px]">CANCELAR</button>
            </div>
        </div>
    </div>

    <script>
        /* JAVASCRIPT ORIGINAL PRESERVADO 100% */
        const load = (key) => JSON.parse(localStorage.getItem(key)) || [];
        const save = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        const horarios = ["08:30", "09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "12:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00"];
        let comandaAtiva = null;

        window.onload = () => {
            document.getElementById('data-seletor').valueAsDate = new Date();
            renderTudo();
        };

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.sidebar-item').forEach(m => m.classList.remove('active-menu'));
            document.getElementById('sec-' + id).classList.remove('hidden');
            document.getElementById('menu-' + id).classList.add('active-menu');
            if(id === 'relatorio') renderFiscal();
        }

        function clicarAgenda(pId, h, data) {
            const agenda = JSON.parse(localStorage.getItem('barbearia_agenda')) || {};
            const cliente = agenda[data]?.[pId]?.[h];
            if (cliente) {
                comandaAtiva = { pId, h, data, cliente };
                document.getElementById('venda-info').innerText = `Cliente: ${cliente} | Hora: ${h}`;
                const profs = load('barbearia_profs');
                const itens = [...load('barbearia_produtos'), ...load('barbearia_servicos')];
                document.getElementById('venda-prof').innerHTML = profs.map(p => `<option value="${p.id}" ${p.id == pId ? 'selected' : ''}>${p.nome}</option>`).join('');
                document.getElementById('venda-item').innerHTML = itens.map(i => `<option value="${i.id}">${i.nome} - R$ ${i.preco}</option>`).join('');
                document.getElementById('modal-venda').classList.remove('hidden');
            } else {
                const n = prompt("Nome do Cliente:");
                if (n) {
                    if (!agenda[data]) agenda[data] = {};
                    if (!agenda[data][pId]) agenda[data][pId] = {};
                    agenda[data][pId][h] = n;
                    localStorage.setItem('barbearia_agenda', JSON.stringify(agenda));
                    renderTudo();
                }
            }
        }

        function excluirHorario() {
            let agenda = JSON.parse(localStorage.getItem('barbearia_agenda')) || {};
            if(comandaAtiva) {
                delete agenda[comandaAtiva.data][comandaAtiva.pId][comandaAtiva.h];
                localStorage.setItem('barbearia_agenda', JSON.stringify(agenda));
                document.getElementById('modal-venda').classList.add('hidden');
                renderTudo();
            }
        }

        function finalizarVendaReal() {
            const pId = document.getElementById('venda-prof').value;
            const iId = document.getElementById('venda-item').value;
            const pag = document.getElementById('venda-pag').value;
            const item = [...load('barbearia_produtos'), ...load('barbearia_servicos')].find(i => i.id == iId);
            const hoje = new Date().toISOString().split('T')[0];

            let historico = JSON.parse(localStorage.getItem('barbearia_historico')) || {};
            if(!historico[hoje]) historico[hoje] = { pix:0, dinheiro:0, debito:0, credito:0, total:0 };
            historico[hoje][pag] += item.preco;
            historico[hoje].total += item.preco;
            localStorage.setItem('barbearia_historico', JSON.stringify(historico));

            let profs = load('barbearia_profs');
            const idx = profs.findIndex(p => p.id == pId);
            if(idx !== -1) profs[idx].faturamento += item.preco;
            save('barbearia_profs', profs);

            if(comandaAtiva) excluirHorario();
            else document.getElementById('modal-venda').classList.add('hidden');
            renderTudo();
        }

        function salvarProfissional() {
            const n = document.getElementById('p-nome').value;
            const c = document.getElementById('p-com').value;
            const p = document.getElementById('p-pass').value;
            if(!n || !c || !p) return alert("Preencha tudo!");
            let profs = load('barbearia_profs');
            profs.push({ id: Date.now(), nome: n, comissao: parseInt(c), pass: p, faturamento: 0 });
            save('barbearia_profs', profs);
            renderTudo();
        }

        function salvarItem() {
            const n = document.getElementById('item-nome').value;
            const p = parseFloat(document.getElementById('item-preco').value);
            const t = document.getElementById('item-tipo').value;
            if(!n || isNaN(p)) return alert("Dados inválidos!");
            const key = t === 'produto' ? 'barbearia_produtos' : 'barbearia_servicos';
            let list = load(key);
            list.push({ id: Date.now(), nome: n, preco: p });
            save(key, list);
            renderTudo();
        }

        function excluir(key, id) {
            if(confirm("Deseja excluir?")) {
                save(key, load(key).filter(x => x.id != id));
                renderTudo();
            }
        }

        function renderTudo() {
            const profs = load('barbearia_profs');
            const prods = load('barbearia_produtos');
            const servs = load('barbearia_servicos');
            const hoje = new Date().toISOString().split('T')[0];
            const hist = JSON.parse(localStorage.getItem('barbearia_historico')) || {};
            const dHoje = hist[hoje] || { pix:0, dinero:0, debito:0, credito:0, total:0 };

            document.getElementById('dash-total').innerText = `R$ ${dHoje.total.toFixed(2)}`;
            document.getElementById('dash-cards').innerHTML = `
                <div class="glass p-2 rounded-xl border-b-2 border-sky-500 text-center text-[10px]">PIX<br><b>R$ ${dHoje.pix?.toFixed(2) || '0.00'}</b></div>
                <div class="glass p-2 rounded-xl border-b-2 border-emerald-500 text-center text-[10px]">DINH<br><b>R$ ${dHoje.dinheiro?.toFixed(2) || '0.00'}</b></div>
                <div class="glass p-2 rounded-xl border-b-2 border-purple-500 text-center text-[10px]">DEB<br><b>R$ ${dHoje.debito?.toFixed(2) || '0.00'}</b></div>
                <div class="glass p-2 rounded-xl border-b-2 border-orange-500 text-center text-[10px]">CRED<br><b>R$ ${dHoje.credito?.toFixed(2) || '0.00'}</b></div>`;

            const grid = document.getElementById('grid-agenda');
            grid.style.gridTemplateColumns = `80px repeat(${profs.length || 1}, 1fr)`;
            grid.innerHTML = `<div class="cell bg-slate-800 font-bold">HORA</div>` + profs.map(p => `<div class="cell bg-slate-800 text-[10px] font-bold uppercase">${p.nome.split(' ')[0]}</div>`).join('');
            
            const agenda = JSON.parse(localStorage.getItem('barbearia_agenda')) || {};
            const dataSel = document.getElementById('data-seletor').value;
            horarios.forEach(h => {
                grid.innerHTML += `<div class="cell bg-slate-900/50 text-sky-400 font-bold">${h}</div>`;
                profs.forEach(p => {
                    const res = agenda[dataSel]?.[p.id]?.[h];
                    grid.innerHTML += `<div class="cell ${res ? 'bg-red-500 text-white font-bold' : 'bg-emerald-500/20 text-emerald-400'}" onclick="clicarAgenda(${p.id}, '${h}', '${dataSel}')">${res || 'LIVRE'}</div>`;
                });
            });

            document.getElementById('list-produtos').innerHTML = prods.map(p => `<tr><td>${p.nome}</td><td>R$ ${p.preco}</td><td class="text-right"><button onclick="excluir('barbearia_produtos', ${p.id})" class="text-red-500 p-1"><i class="fas fa-trash"></i></button></td></tr>`).join('');
            document.getElementById('list-servicos').innerHTML = servs.map(s => `<tr><td>${s.nome}</td><td>R$ ${s.preco}</td><td class="text-right"><button onclick="excluir('barbearia_servicos', ${s.id})" class="text-red-500 p-1"><i class="fas fa-trash"></i></button></td></tr>`).join('');
            
            document.getElementById('lista-equipe').innerHTML = profs.map(p => `<tr class="border-b border-slate-900"><td class="py-2 text-sky-500">PROF</td><td>${p.nome}</td><td>${p.comissao}%</td><td class="text-right"><button onclick="excluir('barbearia_profs', ${p.id})" class="text-red-500 p-1"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }

        function renderFiscal() {
            const hist = JSON.parse(localStorage.getItem('barbearia_historico')) || {};
            const hoje = new Date().toISOString().split('T')[0];
            const dHoje = hist[hoje] || { pix:0, dinheiro:0, debito:0, credito:0, total:0 };
            document.getElementById('relatorio-box').innerHTML = `
                <div class="nota-fiscal">
                    <p class="text-center font-bold">BARBEARIA 301</p>
                    <hr class="border-black my-2 border-dashed">
                    <p>TOTAL DIA: R$ ${dHoje.total.toFixed(2)}</p>
                    <hr class="border-black my-2 border-dashed">
                    ${load('barbearia_profs').map(p => `<p>${p.nome}: R$ ${(p.faturamento * p.comissao / 100).toFixed(2)}</p>`).join('')}
                </div>`;
        }

        function enviarRelatorio() { alert("Relatórios enviados!"); }
    </script>
</body>
</html>
